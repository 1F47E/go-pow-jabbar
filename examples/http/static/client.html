<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challenge Solver</title>
    <script src="solver.js" defer></script>
</head>
<body>

<button id="solveBtn">Solve Challenge</button>
<p id="loadingMsg" style="display: none;">Solving...</p>
<p id="results"></p>

<script>
    const API_URL = "http://localhost:8080";
    const API_GET_CHALLENGE = API_URL + "/challenge";
    const API_VERIFY_SOLUTION = API_URL + "/solution";
    
    document.getElementById('solveBtn').addEventListener('click', async () => {
        const solveBtn = document.getElementById('solveBtn');
        const loadingMsg = document.getElementById('loadingMsg');
        const resultsElem = document.getElementById('results');
        
        solveBtn.disabled = true;
        loadingMsg.style.display = 'block';

        const startTime = new Date().getTime();
        
        // get challenge
        const challengeResponse = await fetch(API_GET_CHALLENGE);
        const challenge = await challengeResponse.json();
        console.log("Challenge:", challenge)

        // solve challenge
        const solution = await solveChallenge(challenge.data, challenge.criteria);
        console.log("Solution:", solution)
        
        // fail if not solved within 1 second
        const currentTime = new Date().getTime();
        if (currentTime - startTime > 1000) {
            resultsElem.textContent = 'Failed to solve challenge within 1 second!';
            return;
        }

        // submit solution
        const verifyResponse = await fetch(API_VERIFY_SOLUTION, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                data: solution.data,
                value: solution.addedValue,
                hash: solution.hash
            })
        });

        const verification = await verifyResponse.json();

        // results
        const totalTime = new Date().getTime() - startTime;
        resultsElem.textContent = verification.success ? 
            `Success! Took ${totalTime}ms` : 
            `Error: ${verification.error}. Took ${totalTime}ms`;

        solveBtn.disabled = false;
        loadingMsg.style.display = 'none';
    });
</script>

</body>
</html>
